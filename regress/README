     Bacula Regression
     Kern Sibbald
     April 2003

This is Bacula's regression script directory.  At this time
(May 2003), it is still in development, so all the tests are
not complete.

To set it up, first edit Makefile and set BACULA-SOURCE to point
to your source.

!!!!!!!!!! IMPORTANT !!!!!!!!
Second, edit the EMAIL address in the Makefile to be your
email address and not mine or I will get LOTS of unwanted
email!

Third, edit the DEPKGS path in the Makefile to point to the
depkgs directory.

Fourth, make sure that depkgs is pre-built if it isn't 
already: (cd your-depkgs; make sqlite).

Then do:

   make setup

You run the above one time.  This will copy the Bacula
source, configure, build it, and configure all the scripts
and conf files.  If you change your source, you will need
to redo this command. 

Then you can run any of the tests in the tests subdirectory.
Each test whose name ends in -root requires you to be root for
a resonable run.  Each test is totally independent of any other
test. Aside from the required "make setup", each test is totally
self-initalizing and should clean up after itself.

Not all the tests yet report OK.  This is simply because there are
some spurious differences that I haven't yet taken the time to
eliminate.  The working scrips as of 24 Apr 03 are:

backup-bacula-test
sparse-test
compressed-test
sparse-compressed-test
two-jobs-test
wierd-files-test
verify-vol-test

The tests expect you to execute them from the main regress 
directory!               

You can run them individually as:

   tests/two-jobs-test

or all non-root tests (my normal testing under my account)

  ./all-non-root-tests

or all tests (I only run these before a production release):

   su
   ./all-tests


after running the root tests, while still root, it is a good idea
to do:

   make reset

this cleans up any files that may be created with root permissions.

If you want to add more tests, do so by putting the shell script 
in the tests subdirectory. Be careful when adding (or better not)
new clients, pools, and such to the test-bacula-dir.conf.in file
as it may invalidate a good number of tests, which respond to
questions by answering with a number (i.e. the order of the selection
list is known). It might be better to add your own testb-bacula...
configuration file.  

To avoid re-doing a make setup if you have made a change to the
conf files, and you do not need a new copy of the source, you can simply do:

   scripts/do-sed <your-email-address>
